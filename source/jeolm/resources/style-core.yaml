$target$able: off

$style:

- document class: article
  options: [a4paper,10pt]
  condition: {not: no-document-class}
- package: inputenc
  options: [utf8]
  condition: {or: [compiler-latex, compiler-pdflatex]}
- package: amsmath
- package: amssymb
- delegate: font-config
  condition: {not: no-font-config}
- delegate: math-font-config
  condition: {not: no-font-config}

- delegate: jeolm

- delegate: math-symbols-config
  condition: {not: no-font-config}

- delegate: language-config
  condition: {not: no-language-config}
- verbatim: '\pagestyle{empty}'
  provide: pagestyle
  condition: {not: no-pagestyle}

- delegate: optional

font-config:
  $style[compiler-latex]:
  - delegate: fontenc
  $style[compiler-pdflatex]:
  - delegate: fontenc
  $style[compiler-xelatex]:
  - delegate: fontspec
  $style[compiler-lualatex]:
  - delegate: fontspec

  fontenc:
    $style:
    - package: fontenc
      options: [T2A]

  fontspec:
    $style:
    - package: xparse
      options: [log-declarations=false]
    - package: fontspec
      options: [no-math]
    - verbatim:
        \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
    - delegate: setfont
    setfont:
      $style:
      - delegate: cm-unicode
      $style[xits]:
      - delegate: xits
      xits:
        $style:
        - verbatim: |-
            \setmainfont
              [
                Path = /usr/share/texmf-dist/fonts/opentype/public/xits/,
                Extension=.otf,
                UprightFont=*-regular,
                BoldFont=*-bold,
                ItalicFont=*-italic,
                BoldItalicFont=*-bolditalic,
              ]
              {xits}
            \let\cyrillicfont\normalfont
          provide: setmainfont
        - delegate: ../liberation/sans
        - delegate: ../liberation/mono
      cm-unicode:
        $style:
        - delegate: main
        - delegate: sans
        - delegate: mono
        main:
          $style:
          - verbatim: |-
              \setmainfont[
                Path = /usr/share/texmf-dist/fonts/opentype/public/cm-unicode/,
                Extension=.otf,
                BoldFont=cmunbx, ItalicFont=cmunti, BoldItalicFont=cmunbi,
                SlantedFont=cmunsl,
                SmallCapsFont=cmunrm, SmallCapsFeatures={Letters=SmallCaps},
              ]{cmunrm}
              \let\cyrillicfont\normalfont
            provide: setmainfont
        sans:
          $style:
          - verbatim: |-
              \setsansfont[
                Path = /usr/share/texmf-dist/fonts/opentype/public/cm-unicode/,
                Extension=.otf,
                BoldFont=cmunsx, ItalicFont=cmunsi, BoldItalicFont=cmunso,
              ]{cmunss}
              \let\cyrillicfontsf\sffamily
            provide: setsansfont
        mono:
          $style:
          - verbatim: |-
              \setmonofont[
                Path = /usr/share/texmf-dist/fonts/opentype/public/cm-unicode/,
                Extension=.otf,
                BoldFont=cmuntb, ItalicFont=cmunit, BoldItalicFont=cmuntx,
                SlantedFont=cmunst,
              ]{cmuntt}
              \let\cyrillicfonttt\ttfamily
            provide: setmonofont
      liberation:
        $style:
        - delegate: main
        - delegate: sans
        - delegate: mono
        main:
          $style:
          - verbatim: |-
              \setmainfont{Liberation Serif}
              \let\cyrillicfont\normalfont
            provide: setmainfont
        sans:
          $style:
          - verbatim: |-
              \setsansfont{Liberation Sans}
              \let\cyrillicfontsf\sffamily
            provide: setsansfont
        mono:
          $style:
          - verbatim: |-
              \setmonofont{Liberation Mono}
              \let\cyrillicfonttt\ttfamily
            provide: setmonofont
      tinos:
        $style:
        - verbatim: |-
            \setmainfont{Tinos}
            \let\cyrillicfont\normalfont
          provide: setmainfont
      arimo:
        $style:
        - verbatim: |-
            \setsansfont{Arimo}
            \let\cyrillicfontsf\sffamily
          provide: setsansfont
      cousine:
        $style:
        - verbatim: |-
            \setmonofont{Cousine}
            \let\cyrillicfonttt\ttfamily
          provide: setmonofont

math-font-config:
  $style[compiler-latex]:
    []
  $style[compiler-pdflatex]:
    []
  $style[compiler-lualatex]:
    []
  $style[compiler-xelatex]:
  - delegate: unicode-math

  unicode-math:
    $style:
    - delegate: latinmodern
    $style[xits]:
    - delegate: xits
    _package:
      $style:
      - package: unicode-math
        options:
        - vargreek-shape=unicode
    latinmodern:
      $style:
      - delegate: ../_package
      - verbatim: |-
          \setmathfont{latinmodern-math.otf}
        provide: setmathfont
    xits:
      $style:
      - delegate: ../_package
      - verbatim: |-
          \setmathfont
            [Path=/usr/share/texmf-dist/fonts/opentype/public/xits/]
            {xits-math.otf}
        provide: setmathfont

math-symbols-config:
  $style[compiler-latex]:
  - delegate: swap-cm-vargreek
  $style[compiler-pdflatex]:
  - delegate: swap-cm-vargreek
  $style[compiler-xelatex]:
    []
  $style[compiler-lualatex]:
    []

  swap-cm-vargreek:
    $style:
    - verbatim:
        \swapvargreek{phi} \swapvargreek{epsilon} \swapvargreek{kappa}

language-config:
  $style[compiler-latex]:
  - delegate: babel
  $style[compiler-pdflatex]:
  - delegate: babel
  $style[compiler-xelatex]:
  - delegate: polyglossia
  $style[compiler-lualatex]:
  - delegate: polyglossia

  babel:
    $style:
    - package: babel
      options: [russian]

  polyglossia:
    $style:
    - package: polyglossia
    - verbatim: \setdefaultlanguage{russian}
      provide: setdefaultlanguage

jeolm:
  $target$able: on
  $build$compiler$default: pdflatex

optional:
  $style:
  - delegate: geometry
    condition: {not: no-package-geometry}
  - package: parskip
    condition: {not: no-package-parskip}
  - package: multicol
    condition: {not: no-package-multicol}
  - package: graphicx
    condition: {not: no-package-graphicx}
  - package: anyfontsize
    condition: {not: no-package-anyfontsize}
  - delegate: pgfpages
    condition: {not: no-package-pgfpages}
  - delegate: shrink-formulas
    condition: shrink-formulas
  $style[print,-tiled4]:
  - delegate: .[-print]
    condition: {or: [resize-to, 2-on-1, 4-on-1]}
  - delegate: .[2-on-1,-print]
    condition: {not: {or: [resize-to, 2-on-1, 4-on-1]}}
  $style[print,tiled4]:
  - delegate: .[-print]
  $style[tiled4,-print]:
  - delegate: .[a6paper,landscape,4-on-1,-tiled4]
  geometry:
    $style:
    - package: geometry
    - delegate: set-paper-size
    - verbatim: '\geometry{vmargin={2em,2em},hmargin={2em,2em}}'
      provide: geometry:margin
    - verbatim: '\geometry{landscape}'
      provide: geometry:landscape
      condition: landscape
    set-paper-size:
      $style[a6paper]:
      - verbatim: '\geometry{a6paper}'
        provide: geometry:paper
      $style[a5paper]:
      - verbatim: '\geometry{a5paper}'
        provide: geometry:paper
      $style[a4paper]:
      - verbatim: '\geometry{a4paper}'
        provide: geometry:paper
      $style[a3paper]:
      - verbatim: '\geometry{a3paper}'
        provide: geometry:paper
      $style: # default
      - delegate: .[a5paper]
  pgfpages:
    $style[-resize-to,-2-on-1,-4-on-1]: []
    $style:
    - package: pgfpages
    - verbatim: |-
        \renewcommand\pgfsetupphysicalpagesizes{% fix for xelatex
          \pdfpagewidth\pgfphysicalwidth\pdfpageheight\pgfphysicalheight}
      condition: compiler-xelatex
    - delegate: uselayout
    uselayout:
      $style[resize-to,-landscape]:
      - verbatim: '\pgfpagesuselayout{resize to}[a4paper]'
        provide: pgfpagesuselayout
      $style[2-on-1,-landscape]:
      - verbatim: '\pgfpagesuselayout{2 on 1}[a4paper,landscape]'
        provide: pgfpagesuselayout
      $style[4-on-1,-landscape]:
      - verbatim: '\pgfpagesuselayout{4 on 1}[a4paper]'
        provide: pgfpagesuselayout
      $style[resize-to,landscape]:
      - verbatim: '\pgfpagesuselayout{resize to}[a4paper,landscape]'
        provide: pgfpagesuselayout
      $style[2-on-1,landscape]:
      - verbatim: '\pgfpagesuselayout{2 on 1}[a4paper]'
        provide: pgfpagesuselayout
      $style[4-on-1,landscape]:
      - verbatim: '\pgfpagesuselayout{4 on 1}[a4paper,landscape]'
        provide: pgfpagesuselayout
      $style: [] # default
  shrink-formulas:
    $style:
    - verbatim: |-
        \AtBeginDocument{\abovedisplayskip=10pt minus 7pt}
        \AtBeginDocument{\belowdisplayskip=\abovedisplayskip}

